# ===== Development (Vite-Dev-Server) =====
dev.chrispicloud.dev {
  encode zstd gzip

  # /financetracker -> /financetracker/
  @finroot path /financetracker
  redir @finroot /financetracker/ 308

  # API (Prefix strip)
  handle_path /financetracker/api/* {
    reverse_proxy api:8080
  }

  # Frontend Dev (no strip - Vite sees /financetracker/)
  handle /financetracker/* {
    reverse_proxy web:5173
  }

  handle {
    respond "FinanceTracker DEV gateway OK" 200
  }
}

# ===== Production (static Build) =====
chrispicloud.dev {
  encode zstd gzip

  @finroot path /financetracker
  redir @finroot /financetracker/ 308

  # API (Prefix strip)
  handle_path /financetracker/api/* {
    reverse_proxy api:8080
  }

  # Static SPA from /srv/web (dist mount)
  handle_path /financetracker/* {
    root * /srv/web
    file_server
    try_files {path} /index.html
  }

  handle {
    respond "FinanceTracker PROD gateway OK" 200
  }
}
